## 坑and脱坑

#### 回调陷阱

nodejs 异步操作较多,在代码里会有较多的回调嵌套的情况,同时对于每个异步操作都需要判断是否成功执行,使得代码臃肿,可读与维护性差,
采用promise方式解决回调嵌套过多问题,同时可以对链式操作中某一环节产生的错误进行捕获并同意处理,使代码变得更加优雅与简洁,同时promise善于处理多个异步进程同时执行的情况.在最新版本的node中,不需要安装任何依赖即可支持promise方式编程.

##### 手机验证码
手机验证码依赖安装失败,导致整个项目构建不成功
将依赖系统库生成图片改为直接应用canvas绘制后由nodejs输出到页面中.
直接依赖npm包,并重写包内容,实现定制验证码文字宽高,输出点数量,输出线数量,背景颜色,背景图片

#### 内存泄露
首先检查代码中是否有死循环,或重复创建的模块对象,发现并不存在语法问题
之后进行ab压力测试测试接口内存增长速度,通过node-inspector 集成的v8-profiler功能定位到session被重复创建,
检查程序中session中间件初始代码,发现对所有路由均初始化了session,而项目中有些对其他服务提供的接口,这部分接口通过服务器内部调用,req.header中不存在cookie
导致session中间件初始化失败,从而不停重复加载中间件
解决办法, 对指定路由加载session中间件,
更改后问题修复

所有路由增加session ==> 特定路由开启session

#### 打包策略

之前将common下的静态文件直接通配符全部匹配进行打包处理,导致页面样式与脚本收到其他无关js,css的误伤,调整后只按所需进行打包

**.js ==> 打包指定js

#### yog加载配置文件

指定-e参数,否则默认加载dev

#### 修复手机版Safari浏览器input光标过大,

光标会根据input框高度显示,而不是字号值,密码框高度需要比字号稍大,safari对属性为password的字段与其他实现不同

#### passwort-wechat

wechat只支持pc授权,不支持手机版,更改包源码,重新发布npm包
